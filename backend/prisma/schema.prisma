// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserStatus {
  OnLine
  OffLine
}

enum UserRole {
  User
  Admin
}

enum ChannelStatus {
  Active
  Inactive
}

model User {
  // id  Int @id @default(autoincrement())
  login String @id
  createdAt DateTime @default(now())
  name String
  email String @unique
  level Float
  score Int
  token String
  photo String?
  twoFA Boolean
  twoFApwd String?
  status UserStatus
  role UserRole
// Oposit Relations:
  channelList JoinChannel[]
  mutedChannel muteUser[]
  adminChannel makeAdmin[]
  winnedMatchs  Match[] @relation(name: "win")
  lostMatchs  Match[] @relation(name: "lost")
  channelMessage ChannelMessage[]
  privMessageSent PrivMessage[] @relation(name: "sent")
  privMessageReceived PrivMessage[] @relation(name: "received")
  friends AddFriend[] @relation(name: "friend")
  befriend AddFriend[] @relation(name: "befriend")
  blockedUsers BlockUser[] @relation(name: "blocker")
  blockedFrom BlockUser[] @relation(name: "blocked")
}

model Match {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())
  winnerScore Int
  looserScore Int
// Relations:
  winnerid String
  looserid String
  winner User @relation(name: "win", fields: [winnerid], references: [login])
  looser User @relation(name: "lost", fields: [looserid], references: [login])
}

model Channel {
  channelName String @id
  is_pwd Boolean
  pwd String?
  status ChannelStatus
// Oposit Relations:
  userList JoinChannel[]
  userAdminList makeAdmin[]
  mutedUserList muteUser[]
  messages ChannelMessage[]
}

model makeAdmin {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())
// Relations:
  channelId String
  userId String
  channel Channel @relation(fields: [channelId], references: [channelName])
  user User @relation(fields: [userId], references: [login])
  @@unique([channelId, userId])
}

model muteUser {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())
// Relations:
  channelId String
  userId String
  channel Channel @relation(fields: [channelId], references: [channelName])
  user User @relation(fields: [userId], references: [login])
  @@unique([channelId, userId])
}

model JoinChannel {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())
// Relations:
  userId String
  channelId String
  user User @relation(fields: [userId], references: [login])
  channel Channel @relation(fields: [channelId], references: [channelName])
  @@unique([channelId, userId])
}

model ChannelMessage {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())
  message String
// Relations
  fromId  String
  channelId String
  from User @relation(fields: [fromId], references: [login])
  channel Channel @relation(fields: [channelId], references: [channelName])
}

model PrivMessage {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())
  message String
// Relations:
  fromId String
  toId String
  from User @relation(name: "sent", fields: [fromId], references: [login])
  to User @relation(name: "received", fields: [toId], references: [login])
}

model AddFriend {
  id Int @id @default(autoincrement())
  createdAd DateTime @default(now())
// Relations:
  friend1Id String
  friend2Id String
  friend1 User @relation(name: "befriend", fields: [friend1Id], references: [login])
  friend2 User @relation(name: "friend", fields: [friend2Id], references: [login])
}

model BlockUser {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())
// Relations:
  blockerId String
  blockedId String
  blocker User @relation(name: "blocker", fields: [blockerId], references: [login])
  blocked User @relation(name: "blocked", fields: [blockedId], references: [login])
}