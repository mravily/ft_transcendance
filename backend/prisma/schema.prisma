// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  // id  Int @id @default(autoincrement())
  login String @id
  createdAt DateTime @default(now())
  fullName String
  firstName String
  lastName String
  email String @unique
  score Int
  atoken String @unique
  rtoken String @unique
  imgUrl String
  photo Photos?
  twoFA Boolean
  twoFApwd String?
  isOnline Boolean
  isAdmin Boolean

// Oposit Relations:

  channelList JoinChannel[]
  mutedChannel muteUser[]
  adminChannel makeAdmin[]
  winnedMatchs  Match[] @relation(name: "win")
  lostMatchs  Match[] @relation(name: "lost")
  channelMessage ChannelMessage[]
  friends AddFriend[] @relation(name: "friend")
  befriend AddFriend[] @relation(name: "befriend")
  blockedUsers BlockUser[] @relation(name: "blocker")
  blockedFrom BlockUser[] @relation(name: "blocked")
  bannedFrom BanUser[]
}

model Match {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())
  winnerScore Int
  looserScore Int

// Relations:

  winnerid String
  looserid String
  winner User @relation(name: "win", fields: [winnerid], references: [login])
  looser User @relation(name: "lost", fields: [looserid], references: [login])
}

model Channel {
  createdAt DateTime @default(now())
  channelName String @id
  is_pwd Boolean
  pwd String?
  isActive Boolean

// Oposit Relations:

  userList JoinChannel[]
  userAdminList makeAdmin[]
  mutedUserList muteUser[]
  bannedUsers BanUser[]
  messages ChannelMessage[]
}

model makeAdmin {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())

// Relations:

  channelId String
  userId String
  channel Channel @relation(fields: [channelId], references: [channelName])
  user User @relation(fields: [userId], references: [login])
  @@unique([channelId, userId])
}

model muteUser {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())

// Relations:

  channelId String
  userId String
  channel Channel @relation(fields: [channelId], references: [channelName])
  user User @relation(fields: [userId], references: [login])
  @@unique([channelId, userId])
}

model BanUser {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())

  // Relations:

  channelId String
  userId String
  channel Channel @relation(fields: [channelId], references: [channelName])
  user User @relation(fields: [userId], references: [login])
  @@unique([channelId, userId])
}

model JoinChannel {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())

// Relations:

  userId String
  channelId String
  user User @relation(fields: [userId], references: [login])
  channel Channel @relation(fields: [channelId], references: [channelName])
  @@unique([channelId, userId])
}

model ChannelMessage {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())
  message String

// Relations:

  fromId  String
  channelId String
  from User @relation(fields: [fromId], references: [login])
  channel Channel @relation(fields: [channelId], references: [channelName])
}

model AddFriend {
  id Int @id @default(autoincrement())
  createdAd DateTime @default(now())

// Relations:
  friend1Id String
  friend2Id String
  friend1 User @relation(name: "befriend", fields: [friend1Id], references: [login])
  friend2 User @relation(name: "friend", fields: [friend2Id], references: [login])
}

model BlockUser {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())

// Relations:
  blockerId String
  blockedId String
  blocker User @relation(name: "blocker", fields: [blockerId], references: [login])
  blocked User @relation(name: "blocked", fields: [blockedId], references: [login])
}

model Photos {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())
  filename String

// Relations:
  userId String @unique
  user User @relation(fields: [userId], references: [login])
}